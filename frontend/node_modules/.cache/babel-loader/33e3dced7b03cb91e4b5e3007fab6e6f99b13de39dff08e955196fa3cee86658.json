{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);const API_URL=process.env.REACT_APP_API_URL||'http://localhost:8000';export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Check if user is already logged in on mount\nuseEffect(()=>{const checkAuth=async()=>{const token=localStorage.getItem('token');if(token){try{const response=await axios.get(\"\".concat(API_URL,\"/api/auth/me\"),{headers:{Authorization:\"Bearer \".concat(token)}});setUser(response.data);}catch(err){console.error('Authentication error:',err);localStorage.removeItem('token');}}setLoading(false);};checkAuth();},[]);const login=async(username,password)=>{try{setLoading(true);setError(null);const formData=new FormData();formData.append('username',username);formData.append('password',password);const response=await axios.post(\"\".concat(API_URL,\"/api/auth/token\"),formData);localStorage.setItem('token',response.data.access_token);// Get user data\nconst userResponse=await axios.get(\"\".concat(API_URL,\"/api/auth/me\"),{headers:{Authorization:\"Bearer \".concat(response.data.access_token)}});setUser(userResponse.data);}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||'Login failed');throw err;}finally{setLoading(false);}};const register=async(username,email,password)=>{try{setLoading(true);setError(null);await axios.post(\"\".concat(API_URL,\"/api/auth/register\"),{username,email,password,preferences:{knowledge_level:5.0,prefer_explanations:0.6,prefer_examples:0.3,prefer_resources:0.1,prefer_length:0.5}});// Login after successful registration\nawait login(username,password);}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||'Registration failed');throw err;}finally{setLoading(false);}};const logout=()=>{localStorage.removeItem('token');setUser(null);};const updatePreferences=async preferences=>{try{setLoading(true);setError(null);const token=localStorage.getItem('token');if(!token||!user){throw new Error('Not authenticated');}const response=await axios.put(\"\".concat(API_URL,\"/api/users/me\"),{preferences},{headers:{Authorization:\"Bearer \".concat(token)}});setUser(response.data);}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.detail)||'Failed to update preferences');throw err;}finally{setLoading(false);}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,error,login,register,logout,updatePreferences},children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","axios","jsx","_jsx","AuthContext","undefined","API_URL","process","env","REACT_APP_API_URL","AuthProvider","_ref","children","user","setUser","loading","setLoading","error","setError","checkAuth","token","localStorage","getItem","response","get","concat","headers","Authorization","data","err","console","removeItem","login","username","password","formData","FormData","append","post","setItem","access_token","userResponse","_err$response","_err$response$data","detail","register","email","preferences","knowledge_level","prefer_explanations","prefer_examples","prefer_resources","prefer_length","_err$response2","_err$response2$data","logout","updatePreferences","Error","put","_err$response3","_err$response3$data","Provider","value","useAuth","context"],"sources":["/Users/dauletkaparov/Desktop/MVP2/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport axios from 'axios';\n\ninterface User {\n  id: string;\n  username: string;\n  email: string;\n  preferences: Record<string, any>;\n  created_at: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  error: string | null;\n  login: (username: string, password: string) => Promise<void>;\n  register: (username: string, email: string, password: string) => Promise<void>;\n  logout: () => void;\n  updatePreferences: (preferences: Record<string, any>) => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Check if user is already logged in on mount\n  useEffect(() => {\n    const checkAuth = async () => {\n      const token = localStorage.getItem('token');\n      if (token) {\n        try {\n          const response = await axios.get(`${API_URL}/api/auth/me`, {\n            headers: {\n              Authorization: `Bearer ${token}`\n            }\n          });\n          setUser(response.data);\n        } catch (err) {\n          console.error('Authentication error:', err);\n          localStorage.removeItem('token');\n        }\n      }\n      setLoading(false);\n    };\n\n    checkAuth();\n  }, []);\n\n  const login = async (username: string, password: string) => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const formData = new FormData();\n      formData.append('username', username);\n      formData.append('password', password);\n      \n      const response = await axios.post(`${API_URL}/api/auth/token`, formData);\n      localStorage.setItem('token', response.data.access_token);\n      \n      // Get user data\n      const userResponse = await axios.get(`${API_URL}/api/auth/me`, {\n        headers: {\n          Authorization: `Bearer ${response.data.access_token}`\n        }\n      });\n      \n      setUser(userResponse.data);\n    } catch (err: any) {\n      setError(err.response?.data?.detail || 'Login failed');\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const register = async (username: string, email: string, password: string) => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      await axios.post(`${API_URL}/api/auth/register`, {\n        username,\n        email,\n        password,\n        preferences: {\n          knowledge_level: 5.0,\n          prefer_explanations: 0.6,\n          prefer_examples: 0.3,\n          prefer_resources: 0.1,\n          prefer_length: 0.5\n        }\n      });\n      \n      // Login after successful registration\n      await login(username, password);\n    } catch (err: any) {\n      setError(err.response?.data?.detail || 'Registration failed');\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    setUser(null);\n  };\n\n  const updatePreferences = async (preferences: Record<string, any>) => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const token = localStorage.getItem('token');\n      if (!token || !user) {\n        throw new Error('Not authenticated');\n      }\n      \n      const response = await axios.put(\n        `${API_URL}/api/users/me`,\n        { preferences },\n        {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }\n      );\n      \n      setUser(response.data);\n    } catch (err: any) {\n      setError(err.response?.data?.detail || 'Failed to update preferences');\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ \n      user, \n      loading, \n      error, \n      login, \n      register, \n      logout,\n      updatePreferences\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}